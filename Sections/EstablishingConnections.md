## Establishing Connections

It is expected that STTP will normally be used over Internet Protocol. In order to meet the entire set of capabilities as enumerated in this specification, a TCP/IP based connection will be required. A single established TCP connection can be used to meet the requirements for both the _command channel_ and _data channel_ functions. UDP/IP connections can also be used for data channel functions when used in conjunction with a TCP based command channel, however, use of UDP connections for STTP data will reduce the set of capabilities that can be supported. As an example, use of UDP means that data can be dropped, so any form of stateful compression that requires delivery guarantees cannot be supported.

> :information_source: UDP only style deliveries, unicast or multicast, of data using STTP can only be accommodated with substantial capability restrictions. That is, with no reliable command channel, consumers of STTP data provided over a UDP only connection would be subject to the publisher established format, content and resolution of the data being delivered. Alternately, establishment of a UDP based command channel would require adjustments in protocol behavior to accommodate failure to send command requests and/or receive responses due to lack of delivery guarantees.  While it is expected that with the right set of initial assumptions and capability restrictions that STTP could effectively operate with a UDP only connection, the main text of the specification will intentionally remain silent on such details for the sake of simplicity, clarity and brevity.

> :construction: Add an appendix to discuss how a UDP only STTP transmission should work so that needed caveats and capability restrictions can be established for this behavior. Describing this operation is important given the widely used UDP only synchrophasor deployments in production use today and such a deployment may also be desirable in environments like a lab. Regardless of the veracity of logical technical arguments that can be made to not use UDP, either only or in combination with TCP, by not defining the protocol behavior in these modes of operation there is increased risk of the protocol not being initially adopted or accepted, even by project participants. Having these behaviors documented will help alleviate any out-of-standard implementations that may crop up otherwise. Reference implementations will be adjusted to accommodate these use-case as time allows, but implementation of UDP options will be at lower priority. UDP use cases will be kept in-mind during code development such that future iterations of the reference implementations can accommodate UDP based behaviors and functionality more readily.

### Simple Connections

For basic STTP connections, such as those being established inside a controlled environment or in cases where data sensitivity is not a concern, a basic IP based socket connection can be established for STTP communications.

Details of establishing a socket connection are specific to an operating system and ultimately the programming language being used. Even so, the minimum needed information to create the socket is (1) an endpoint, i.e., the IP address and port number, (2) the desired transport protocol, e.g., TCP or UDP, and (3) the type connection to be established, i.e., a server-style socket or a client-style socket. A server-style socket is one that will listen for connections from clients. A client-style socket is one that will connect to a listening server socket. Client-style sockets are always the _initiators_ of any given connection.

It follows naturally then that publishers, as data providers, would use server-style sockets and that subscribers, as data consumers, would use client-style sockets to initiate connections to the publisher's listening socket. Establishing a server-style socket for a publisher and client-style sockets for its subscribers describes a connectivity model that is called a _forward connection_. Forward connections are  expected to the normal use case for STTP publisher/subscriber connections.

However, for an STTP connection is does not matter which party, publisher or subscriber, is the server or the client from a socket perspective. For example, it is perfectly valid for a publisher to initiate a client-style socket connection to a subscriber that is listening with an established server-style socket. This type of connectivity model is called a _reverse connection_. It is important to note that reverse connections will not change the functions, roles or responsibilities of the participants, that is, a publisher will still be the provider of data and the subscriber will still be the consumer of data. Additionally, any required protocol negotiations by the parties will continue as normal once the connection has been established.

This level of flexibility in the connectivity models is necessary so that security boundaries that have been enforced with firewall rules can be maintained. A common use case is that the publisher, and the data it is has access to for publication, will exist in a secure network environment and the subscribers, which need access to the data, exist in less secure network environments. In this case, firewall rules will prohibit any connections to be initiated from an environment that is considered less secure. However, the environments do allow connections to be initiated from inside the secure environment to listening connection in a less secure environment. Described more simply, nothing can reach in to systems in the secure environment, but systems in the secure environment can reach out - this much like how a home computer can access the Internet through a router, but the router's built-in firewall prevents systems on the Internet from accessing the home computer. Since a client-style connection is the only type of socket that can initiate a connection, the publisher would need to use a reverse connection using a client-style socket to connect to a subscriber that was established with a listening server-style socket so that the subscriber would be able to receive data.

Reverse connections flip the responsibility of establishing connectivity to the parties that provision the data. For this mode of operation, data subscribers, which might otherwise come and go as needed, now become a persistent resource that is readily available for connection from its publisher. Reverse connections will typically require data flow planning and network engineering and to make sure data is reliably sent in the desired locations with connections that are initiated from secure locations. Although reverse connections may initially seem counter-intuitive, they exist as firm STTP requirement for successful data exchange within secure environments.

#### Bidirectional Data Exchange

#### UDP Restrictions with Simple Connections

### Secure Connections

For data transmissions over the Internet or those that need to transmit sensitive data, a secured socket connection will need to be established for STTP communications. To secure a connection, a socket will be established with standard Transport Layer Security (TLS) using a signed X.509 certificate. TLS will be used to encrypt, authenticate and attest to the integrity of the data being transmitted over STTP.

TLS is a protocol layer that sits above TCP, as a result, secure connections will be established in exactly the same manner as simple connections, however TLS will handle the needed negotiations to enable security. Once the base TCP connection is established, TLS security will added to the socket not directly interfere with   Since it is expected that implementations of

#### Certificates

STTP implementations should have the capability to use either self-signed certificates or those signed by a certificate authority (CA).

> :wrench: Through configuration, STTP implementations should be able to gracefully accommodate use cases where the validation of signed certificates encounters errors, e.g., the common name mismatch error <sup>[[18](References.md#user-content-ref18)]</sup>. This is important since STTP can be deployed be in environments where there is no public Internet access or where a client connection may appear to have a mismatched IP addresses due to a difference caused by NAT configuration. Certificate error conditions such as the inability to verify hostnames, IP addresses or contact an issuing CA should mitigatable through configuration. For user interfaces, appropriate warnings and feedback should be provided as to possible impact on security. Any new configurations should always default to the highest level of security and error warnings but be easily adjustable for any given environment as deemed appropriate by a user.

#### UDP Security with Secure Connections

### Connection Negotiations

After a successful connection has been established, the publisher and subscriber will participate in a set of initial set of negotiations that will determine the operational...
